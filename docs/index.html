<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>StepSyncAI - Personal Health & Wellness Platform</title>
  <meta name="description" content="Track your mental health, medication, sleep, exercise, and get personalized wellness insights.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ú®</text></svg>">
  
  <!-- PWA Support -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3b82f6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="StepSyncAI">
  <style>
    /* Dark mode (default) */
    :root{--bg:#0f172a;--card:#1e293b;--card-hover:#273549;--accent:#3b82f6;--accent-2:#60a5fa;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--text:#f1f5f9;--muted:#94a3b8;--border:#334155;--radius:12px}
    /* Light mode */
    [data-theme="light"]{--bg:#f8fafc;--card:#ffffff;--card-hover:#f1f5f9;--accent:#2563eb;--accent-2:#3b82f6;--success:#059669;--warning:#d97706;--danger:#dc2626;--text:#0f172a;--muted:#64748b;--border:#e2e8f0}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh}
    .container{max-width:1200px;margin:0 auto;padding:1rem}

    /* Header */
    header{background:var(--card);border-bottom:1px solid var(--border);padding:1rem 0;position:sticky;top:0;z-index:100}
    .header-content{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
    .logo{display:flex;align-items:center;gap:.75rem;font-size:1.5rem;font-weight:800;color:var(--accent);text-decoration:none}
    .badge{background:var(--success);color:#fff;padding:.25rem .75rem;border-radius:999px;font-size:.75rem;font-weight:600}

    /* Navigation Tabs */
    .nav-tabs{display:flex;gap:.5rem;flex-wrap:wrap}
    .nav-tab{background:transparent;border:1px solid var(--border);color:var(--muted);padding:.5rem 1rem;border-radius:8px;cursor:pointer;font-weight:600;transition:all .2s;font-size:.875rem}
    .nav-tab:hover{border-color:var(--accent);color:var(--accent)}
    .nav-tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    .nav-tab .icon{margin-right:.5rem}

    /* Main Content */
    main{padding:1.5rem 0}
    .app-section{display:none}
    .app-section.active{display:block}

    /* Cards */
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;margin-bottom:1.5rem}
    .card-title{font-size:1.25rem;font-weight:700;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}

    /* Forms */
    .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}
    .form-group{margin-bottom:1rem}
    .form-group label{display:block;font-weight:600;margin-bottom:.5rem;color:var(--muted);font-size:.875rem}
    input,select,textarea{width:100%;padding:.75rem;border:1px solid var(--border);border-radius:8px;background:var(--bg);color:var(--text);font-size:1rem}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent)}
    input[type="range"]{padding:0}

    /* Buttons */
    .btn{padding:.75rem 1.5rem;border-radius:8px;font-weight:700;cursor:pointer;transition:all .2s;border:none;font-size:.9rem}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-primary:hover{background:var(--accent-2)}
    .btn-success{background:var(--success);color:#fff}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-secondary{background:var(--card);color:var(--text);border:1px solid var(--border)}
    .btn-group{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:1rem}

    /* Mood Slider */
    .mood-display{font-size:3rem;text-align:center;margin:1rem 0}
    .mood-scale{display:flex;justify-content:space-between;font-size:.75rem;color:var(--muted);margin-top:.5rem}

    /* Wellness Score */
    .wellness-score{text-align:center;padding:2rem;background:linear-gradient(135deg,var(--card) 0%,var(--bg) 100%);border-radius:var(--radius);margin-bottom:1.5rem}
    .score-circle{width:150px;height:150px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 1rem;font-size:2.5rem;font-weight:800;border:8px solid var(--border)}
    .score-good{border-color:var(--success);color:var(--success)}
    .score-medium{border-color:var(--warning);color:var(--warning)}
    .score-low{border-color:var(--danger);color:var(--danger)}
    .score-label{font-size:1.25rem;color:var(--muted)}

    /* Progress Bars */
    .progress-bar{background:var(--border);border-radius:999px;height:12px;margin:.5rem 0;overflow:hidden}
    .progress-fill{height:100%;border-radius:999px;transition:width .3s}
    .progress-fill.good{background:var(--success)}
    .progress-fill.medium{background:var(--warning)}
    .progress-fill.low{background:var(--danger)}

    /* Data List */
    .data-list{max-height:300px;overflow-y:auto}
    .data-item{background:var(--bg);padding:1rem;border-radius:8px;margin-bottom:.5rem;display:flex;justify-content:space-between;align-items:center}
    .data-item-info{flex:1}
    .data-item-title{font-weight:600}
    .data-item-meta{font-size:.875rem;color:var(--muted)}
    .data-item-value{font-size:1.25rem;font-weight:700}

    /* Stats Grid */
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:1.5rem}
    .stat-card{background:var(--bg);padding:1rem;border-radius:8px;text-align:center}
    .stat-value{font-size:1.75rem;font-weight:800;color:var(--accent)}
    .stat-label{font-size:.75rem;color:var(--muted);margin-top:.25rem}

    /* Medication Grid */
    .med-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem}
    .med-card{background:var(--bg);padding:1rem;border-radius:8px;border-left:4px solid var(--accent)}
    .med-card.taken{border-left-color:var(--success);opacity:.7}
    .med-card.missed{border-left-color:var(--danger)}
    .med-name{font-weight:700;font-size:1.1rem}
    .med-time{color:var(--muted);font-size:.875rem}

    /* Quiz */
    .quiz-question{font-size:1.25rem;margin-bottom:1.5rem}
    .quiz-options{display:grid;gap:.75rem}
    .quiz-option{background:var(--bg);padding:1rem;border-radius:8px;cursor:pointer;border:2px solid var(--border);transition:all .2s}
    .quiz-option:hover{border-color:var(--accent)}
    .quiz-option.correct{border-color:var(--success);background:rgba(16,185,129,.1)}
    .quiz-option.incorrect{border-color:var(--danger);background:rgba(239,68,68,.1)}
    .quiz-option.selected{border-color:var(--accent)}

    /* Insights */
    .insight{background:var(--bg);padding:1rem;border-radius:8px;margin-bottom:.75rem;border-left:4px solid var(--accent)}
    .insight.positive{border-left-color:var(--success)}
    .insight.warning{border-left-color:var(--warning)}
    .insight.negative{border-left-color:var(--danger)}

    /* Responsive */
    @media(max-width:768px){
      .header-content{justify-content:center}
      .stats-grid{grid-template-columns:repeat(2,1fr)}
      
      /* Hide desktop navigation on mobile */
      .nav-tabs{display:none}
      
      /* Add space for bottom navigation */
      main{padding-bottom:5rem}
    }

    /* Mobile Bottom Navigation */
    .mobile-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:2px solid var(--border);padding:.75rem 0;z-index:100;box-shadow:0 -4px 12px rgba(0,0,0,.15)}
    .mobile-nav-inner{display:flex;justify-content:space-around;align-items:center;max-width:600px;margin:0 auto}
    .mobile-nav-btn{display:flex;flex-direction:column;align-items:center;gap:.25rem;background:transparent;border:none;color:var(--muted);cursor:pointer;padding:.5rem;border-radius:8px;transition:all .2s;min-width:60px}
    .mobile-nav-btn:active{transform:scale(.95)}
    .mobile-nav-btn.active{color:var(--accent)}
    .mobile-nav-btn.active .mobile-nav-icon{background:var(--accent);color:#fff}
    .mobile-nav-icon{font-size:1.5rem;transition:all .2s}
    .mobile-nav-label{font-size:.65rem;font-weight:600;text-align:center;line-height:1.1}
    
    @media(max-width:768px){
      .mobile-nav{display:block}
    }

    /* Theme Toggle */
    .theme-toggle{background:var(--card);border:1px solid var(--border);color:var(--text);padding:.5rem;border-radius:8px;cursor:pointer;font-size:1.25rem;transition:all .2s;display:flex;align-items:center;justify-content:center;width:2.5rem;height:2.5rem}
    .theme-toggle:hover{background:var(--card-hover);border-color:var(--accent)}
    .theme-toggle:focus{outline:2px solid var(--accent);outline-offset:2px}

    /* Onboarding Modal */
    .onboarding-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(4px);padding:1rem}
    .onboarding-modal{background:var(--card);border-radius:var(--radius);max-width:500px;width:90%;max-height:90vh;box-shadow:0 25px 50px -12px rgba(0,0,0,.5);border:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
    .onboarding-header{text-align:center;padding:1.5rem 2rem 1rem 2rem;flex-shrink:0}
    .onboarding-icon{font-size:3rem;margin-bottom:.75rem}
    .onboarding-title{font-size:1.5rem;font-weight:800;margin-bottom:.5rem;color:var(--accent)}
    .onboarding-subtitle{color:var(--muted);font-size:.9rem;margin-bottom:1rem}
    .onboarding-content{padding:0 2rem 1rem 2rem;overflow-y:auto;flex:1;min-height:0}
    .onboarding-trackers{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;margin-bottom:1.5rem}
    .onboarding-tracker{display:flex;flex-direction:column;align-items:center;gap:.5rem;padding:.75rem;background:var(--bg);border-radius:8px;text-align:center}
    .onboarding-tracker-icon{font-size:2rem;flex-shrink:0}
    .onboarding-tracker-title{font-weight:600;font-size:.875rem;line-height:1.2}
    .onboarding-actions{display:flex;gap:1rem;flex-direction:column;padding:1rem 2rem 2rem 2rem;flex-shrink:0;background:var(--card);border-top:1px solid var(--border);box-shadow:0 -4px 6px -1px rgba(0,0,0,.1)}

    /* Profile Section */
    .profile-card{background:linear-gradient(135deg,var(--accent) 0%,var(--accent-2) 100%);color:#fff;padding:1.5rem;border-radius:var(--radius);margin-bottom:1.5rem;display:flex;align-items:center;gap:1rem}
    .profile-avatar{width:60px;height:60px;border-radius:50%;background:rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;font-size:2rem;border:3px solid rgba(255,255,255,.3)}
    .profile-info{flex:1}
    .profile-name{font-size:1.25rem;font-weight:700;margin-bottom:.25rem}
    .profile-streak{font-size:.875rem;opacity:.9}
    .profile-actions{display:flex;gap:.5rem}

    /* Wellness Tips */
    .wellness-tips{background:linear-gradient(135deg,var(--success) 0%,#059669 100%);color:#fff;padding:1.5rem;border-radius:var(--radius);margin-bottom:1.5rem}
    .wellness-tips-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}
    .wellness-tips-title{font-size:1.1rem;font-weight:700;display:flex;align-items:center;gap:.5rem}
    .wellness-tips-nav{display:flex;gap:.5rem}
    .wellness-tips-btn{background:rgba(255,255,255,.2);border:none;color:#fff;width:2rem;height:2rem;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
    .wellness-tips-btn:hover{background:rgba(255,255,255,.3)}
    .wellness-tips-content{font-size:.95rem;line-height:1.5}

    /* Streak Chart */
    .streak-chart{display:flex;gap:.25rem;flex-wrap:wrap;justify-content:center;margin:1rem 0}
    .streak-day{width:14px;height:14px;border-radius:3px;background:var(--border);position:relative;transition:all .2s}
    .streak-day.active{background:var(--success)}
    .streak-day.partial{background:var(--warning)}
    .streak-day:hover{transform:scale(1.3);z-index:10}
    .streak-day:hover::after{content:attr(data-date);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:var(--card);color:var(--text);padding:.25rem .5rem;border-radius:4px;font-size:.75rem;white-space:nowrap;margin-bottom:.25rem;border:1px solid var(--border);z-index:100}

    /* Action Buttons */
    .action-buttons{display:flex;gap:.5rem;margin-top:1rem;flex-wrap:wrap}
    .action-btn{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);text-decoration:none;font-weight:600;transition:all .2s;font-size:.875rem;cursor:pointer}
    .action-btn:hover{border-color:var(--accent);color:var(--accent);transform:translateY(-2px)}
    .action-btn:focus{outline:2px solid var(--accent);outline-offset:2px}

    /* SVG Icons */
    .icon-svg{width:20px;height:20px;vertical-align:middle}

    /* Loading State */
    .loading{opacity:.6;pointer-events:none}
    .fade-in{animation:fadeIn .3s ease-in}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}

    /* Accessibility - High Contrast Focus */
    button:focus,input:focus,select:focus,textarea:focus,.nav-tab:focus,.action-btn:focus{outline:2px solid var(--accent);outline-offset:2px}
    
    /* Skip to content link */
    .skip-link{position:absolute;top:-40px;left:0;background:var(--accent);color:#fff;padding:.5rem 1rem;text-decoration:none;border-radius:0 0 8px 0;z-index:100}
    .skip-link:focus{top:0}

    /* Hidden but accessible */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}

    /* Install PWA Button */
    .install-pwa{display:none;position:fixed;bottom:1rem;right:1rem;background:var(--accent);color:#fff;padding:.75rem 1.5rem;border-radius:8px;box-shadow:0 10px 25px rgba(0,0,0,.3);cursor:pointer;font-weight:700;border:none;z-index:99;transition:all .2s}
    .install-pwa:hover{transform:translateY(-2px);box-shadow:0 15px 30px rgba(0,0,0,.4)}
    .install-pwa.show{display:block}

    /* Footer */
    footer{background:var(--card);border-top:1px solid var(--border);padding:2rem 0;margin-top:3rem}
    .footer-content{max-width:1200px;margin:0 auto;padding:0 1rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1.5rem}
    .footer-left{display:flex;flex-direction:column;gap:.5rem}
    .footer-title{font-size:1.25rem;font-weight:700;color:var(--accent)}
    .footer-subtitle{color:var(--muted);font-size:.9rem}
    .footer-right{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}
    .footer-link{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);text-decoration:none;font-weight:600;transition:all .2s;font-size:.9rem}
    .footer-link:hover{border-color:var(--accent);color:var(--accent);transform:translateY(-2px)}
    .tech-badge{display:inline-block;padding:.25rem .75rem;background:var(--bg);border:1px solid var(--border);border-radius:6px;font-size:.75rem;color:var(--muted);font-weight:600}
    @media(max-width:768px){.footer-content{flex-direction:column;text-align:center}.footer-right{justify-content:center}}
  </style>


<body>
  <!-- Accessibility: Skip to main content -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Onboarding Modal (shown to first-time users) -->
  <div id="onboardingOverlay" class="onboarding-overlay" style="display:none;" role="dialog" aria-labelledby="onboarding-title" aria-describedby="onboarding-subtitle" aria-modal="true">
    <div class="onboarding-modal">
      <div class="onboarding-header">
        <div class="onboarding-icon" role="img" aria-label="Welcome">‚ú®</div>
        <h2 id="onboarding-title" class="onboarding-title">Welcome to StepSyncAI!</h2>
        <p id="onboarding-subtitle" class="onboarding-subtitle">Your personal health and wellness companion</p>
      </div>
      <div class="onboarding-content">
        <div class="onboarding-trackers">
          <div class="onboarding-tracker">
            <div class="onboarding-tracker-icon" role="img" aria-label="Mental health">üß†</div>
            <div class="onboarding-tracker-title">Mental Health</div>
          </div>
          <div class="onboarding-tracker">
            <div class="onboarding-tracker-icon" role="img" aria-label="Medication">üíä</div>
            <div class="onboarding-tracker-title">Medication</div>
          </div>
          <div class="onboarding-tracker">
            <div class="onboarding-tracker-icon" role="img" aria-label="Sleep">üò¥</div>
            <div class="onboarding-tracker-title">Sleep</div>
          </div>
          <div class="onboarding-tracker">
            <div class="onboarding-tracker-icon" role="img" aria-label="Exercise">üèÉ</div>
            <div class="onboarding-tracker-title">Fitness</div>
          </div>
        </div>
        <div class="form-group" style="margin-bottom:0">
          <label for="userName">What should we call you? (optional)</label>
          <input type="text" id="userName" placeholder="Your name" aria-describedby="userName-desc">
          <small id="userName-desc" class="sr-only">Enter your preferred name for personalization</small>
        </div>
      </div>
      <div class="onboarding-actions">
        <button class="btn btn-primary" onclick="completeOnboarding()" aria-label="Continue to start using StepSyncAI">Continue ‚Üí</button>
      </div>
    </div>
  </div>

  <header>
    <div class="container">
      <div class="header-content">
        <a href="#" class="logo" aria-label="StepSyncAI home">‚ú® StepSyncAI <span class="badge">LIVE</span></a>
        <nav class="nav-tabs" role="navigation" aria-label="Main navigation">
          <button class="nav-tab active" data-tab="dashboard" aria-label="Dashboard" aria-current="page"><span class="icon" aria-hidden="true">üìä</span><span>Dashboard</span></button>
          <button class="nav-tab" data-tab="mental" aria-label="Mental Health Tracker"><span class="icon" aria-hidden="true">üß†</span><span>Mental Health</span></button>
          <button class="nav-tab" data-tab="medication" aria-label="Medication Tracker"><span class="icon" aria-hidden="true">üíä</span><span>Medication</span></button>
          <button class="nav-tab" data-tab="sleep" aria-label="Sleep Tracker"><span class="icon" aria-hidden="true">üò¥</span><span>Sleep</span></button>
          <button class="nav-tab" data-tab="exercise" aria-label="Exercise Tracker"><span class="icon" aria-hidden="true">üèÉ</span><span>Exercise</span></button>
        </nav>
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark/light mode" title="Toggle theme">
          <span id="themeIcon" aria-hidden="true">üåô</span>
        </button>
      </div>
    </div>
  </header>

  <main id="main-content" class="container" tabindex="-1" role="main" aria-label="Main content">
    <!-- Dashboard -->
    <section id="dashboard" class="app-section active">
      <!-- Profile Card -->
      <div class="profile-card" id="profileCard">
        <div class="profile-avatar" aria-hidden="true">üë§</div>
        <div class="profile-info">
          <div class="profile-name" id="profileName">Welcome!</div>
          <div class="profile-streak" id="profileStreak">Start your wellness journey today</div>
        </div>
        <div class="profile-actions">
          <button class="btn btn-secondary" onclick="editProfile()" aria-label="Edit profile" style="background:rgba(255,255,255,.2);border:none;color:#fff;font-size:.875rem">‚úèÔ∏è Edit</button>
          <button class="btn btn-secondary" onclick="signOut()" aria-label="Sign out and clear all data" style="background:rgba(255,255,255,.2);border:none;color:#fff;font-size:.875rem">üö™ Sign Out</button>
        </div>
      </div>

      <!-- Wellness Tips -->
      <div class="wellness-tips">
        <div class="wellness-tips-header">
          <div class="wellness-tips-title">
            <span aria-hidden="true">üí°</span>
            <span>Wellness Tip of the Day</span>
          </div>
          <div class="wellness-tips-nav">
            <button class="wellness-tips-btn" onclick="previousTip()" aria-label="Previous tip">‚Äπ</button>
            <button class="wellness-tips-btn" onclick="nextTip()" aria-label="Next tip">‚Ä∫</button>
          </div>
        </div>
        <div class="wellness-tips-content" id="wellnessTip" role="region" aria-live="polite">Loading tip...</div>
      </div>

      <div class="wellness-score">
        <div class="score-circle score-medium" id="wellnessCircle" role="img" aria-label="Wellness score">
          <span id="wellnessScore">--</span>
        </div>
        <div class="score-label">Overall Wellness Score</div>
      </div>

      <div class="stats-grid">
        <div class="stat-card"><div class="stat-value" id="statMood" aria-live="polite">--</div><div class="stat-label">Mood Today</div></div>
        <div class="stat-card"><div class="stat-value" id="statSleep" aria-live="polite">--</div><div class="stat-label">Hours Sleep</div></div>
        <div class="stat-card"><div class="stat-value" id="statExercise" aria-live="polite">--</div><div class="stat-label">Min Exercise</div></div>
        <div class="stat-card"><div class="stat-value" id="statMeds" aria-live="polite">--</div><div class="stat-label">Meds Taken</div></div>
      </div>

      <div class="card">
        <div class="card-title">üí° Today's Insights</div>
        <div id="insightsList" role="region" aria-live="polite">
          <div class="insight">Log your daily data to see personalized insights!</div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">
          <span>üî• Activity Streak</span>
        </div>
        <div class="streak-chart" id="streakChart" role="img" aria-label="30-day activity streak visualization">
          <!-- Streak days will be added by JavaScript -->
        </div>
        <p style="text-align:center;font-size:.875rem;color:var(--muted);margin-top:.5rem">Last 30 days activity ‚Ä¢ Green = Active day</p>
      </div>

      <div class="card">
        <div class="card-title">üìà Weekly Progress</div>
        <div class="form-grid">
          <div>
            <label>üß† Mood</label>
            <div class="progress-bar"><div class="progress-fill good" id="progressMood" style="width:0%" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Mood progress"></div></div>
          </div>
          <div>
            <label>üò¥ Sleep</label>
            <div class="progress-bar"><div class="progress-fill medium" id="progressSleep" style="width:0%" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Sleep progress"></div></div>
          </div>
          <div>
            <label>üèÉ Exercise</label>
            <div class="progress-bar"><div class="progress-fill low" id="progressExercise" style="width:0%" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Exercise progress"></div></div>
          </div>
          <div>
            <label>üíä Medication</label>
            <div class="progress-bar"><div class="progress-fill good" id="progressMeds" style="width:0%" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Medication adherence"></div></div>
          </div>
        </div>
      </div>

      <!-- Share & Feedback Actions -->
      <div class="card">
        <div class="card-title">üì£ Share & Feedback</div>
        <div class="action-buttons">
          <button class="action-btn" onclick="shareProgress()" aria-label="Share your progress">
            <span aria-hidden="true">üì§</span> Share Progress
          </button>
          <a class="action-btn" href="https://github.com/Isaloum/StepSyncAI/issues/new" target="_blank" rel="noopener noreferrer" aria-label="Send feedback (opens in new tab)">
            <span aria-hidden="true">üí¨</span> Send Feedback
          </a>
          <a class="action-btn" href="https://github.com/Isaloum/StepSyncAI" target="_blank" rel="noopener noreferrer" aria-label="View source code on GitHub (opens in new tab)">
            <span aria-hidden="true">‚≠ê</span> Star on GitHub
          </a>
          <button class="action-btn" onclick="exportData()" aria-label="Export your data">
            <span aria-hidden="true">üíæ</span> Export Data
          </button>
        </div>
      </div>
    </section>

    <!-- Mental Health -->
    <section id="mental" class="app-section">
      <div class="card">
        <div class="card-title">üß† Log Your Mood</div>
        <div class="form-group">
          <label for="moodSlider">How are you feeling today? (1-10)</label>
          <div class="mood-display" id="moodEmoji" role="img" aria-label="Current mood emoji">üòê</div>
          <input type="range" id="moodSlider" min="1" max="10" value="5" aria-valuemin="1" aria-valuemax="10" aria-valuenow="5" aria-label="Mood rating slider">
          <div class="mood-scale"><span>1 - Very Low</span><span>5 - Neutral</span><span>10 - Excellent</span></div>
        </div>
        <div class="form-group">
          <label id="symptoms-label">Any symptoms today?</label>
          <div class="btn-group" role="group" aria-labelledby="symptoms-label">
            <button class="btn btn-secondary symptom-btn" data-symptom="anxiety" aria-label="Select anxiety symptom" aria-pressed="false">üò∞ Anxiety</button>
            <button class="btn btn-secondary symptom-btn" data-symptom="stress" aria-label="Select stress symptom" aria-pressed="false">üò´ Stress</button>
            <button class="btn btn-secondary symptom-btn" data-symptom="fatigue" aria-label="Select fatigue symptom" aria-pressed="false">üò¥ Fatigue</button>
            <button class="btn btn-secondary symptom-btn" data-symptom="irritability" aria-label="Select irritability symptom" aria-pressed="false">üò§ Irritability</button>
            <button class="btn btn-secondary symptom-btn" data-symptom="hopeful" aria-label="Select hopeful feeling" aria-pressed="false">üåü Hopeful</button>
          </div>
        </div>
        <div class="form-group">
          <label>Notes (optional)</label>
          <textarea id="moodNotes" rows="3" placeholder="How was your day?" aria-label="Mood notes"></textarea>
        </div>
        <button class="btn btn-primary" onclick="saveMood()" aria-label="Save mood entry">üíæ Save Mood Entry</button>
      </div>

      <div class="card">
        <div class="card-title">üìÖ Recent Entries</div>
        <div class="data-list" id="moodHistory"></div>
      </div>
    </section>

    <!-- Medication -->
    <section id="medication" class="app-section">
      <div class="card">
        <div class="card-title">üíä Add Medication</div>
        <div class="form-grid">
          <div class="form-group">
            <label>Medication Name</label>
            <input type="text" id="medName" placeholder="e.g., Vitamin D" oninput="checkDosageRealtime()">
          </div>
          <div class="form-group">
            <label>Dosage</label>
            <input type="text" id="medDosage" placeholder="e.g., 1000 IU" oninput="checkDosageRealtime()">
            <div id="dosageWarning" style="margin-top:0.5rem;font-size:0.85rem;"></div>
          </div>
          <div class="form-group">
            <label>Time</label>
            <select id="medTime">
              <option value="morning">üåÖ Morning</option>
              <option value="afternoon">‚òÄÔ∏è Afternoon</option>
              <option value="evening">üåÜ Evening</option>
              <option value="night">üåô Night</option>
            </select>
          </div>
        </div>
        <button class="btn btn-primary" onclick="addMedication()" aria-label="Add medication to your daily list">‚ûï Add Medication</button>
      </div>

      <div class="card">
        <div class="card-title">üìã Today's Medications</div>
        <div class="med-grid" id="medList"></div>
      </div>

      <div class="card">
        <div class="card-title">‚ö†Ô∏è Drug Interaction Warnings</div>
        <div id="interactionWarnings">
          <div class="insight positive">‚úÖ No dangerous interactions detected.</div>
        </div>
      </div>
    </section>

    <!-- Sleep -->
    <section id="sleep" class="app-section">
      <div class="card">
        <div class="card-title">üò¥ Log Sleep</div>
        <div class="form-grid">
          <div class="form-group">
            <label>Bedtime</label>
            <input type="time" id="sleepBedtime" value="22:00">
          </div>
          <div class="form-group">
            <label>Wake Time</label>
            <input type="time" id="sleepWake" value="06:00">
          </div>
          <div class="form-group">
            <label>Sleep Quality (1-10)</label>
            <input type="range" id="sleepQuality" min="1" max="10" value="7">
            <div class="mood-scale"><span>Poor</span><span>Average</span><span>Excellent</span></div>
          </div>
        </div>
        <button class="btn btn-primary" onclick="saveSleep()" aria-label="Save sleep entry">üíæ Save Sleep Entry</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card"><div class="stat-value" id="avgSleep">--</div><div class="stat-label">Avg Hours</div></div>
        <div class="stat-card"><div class="stat-value" id="avgQuality">--</div><div class="stat-label">Avg Quality</div></div>
        <div class="stat-card"><div class="stat-value" id="sleepDebt">--</div><div class="stat-label">Sleep Debt</div></div>
        <div class="stat-card"><div class="stat-value" id="sleepStreak">--</div><div class="stat-label">Day Streak</div></div>
      </div>

      <div class="card">
        <div class="card-title">üìÖ Sleep History</div>
        <div class="data-list" id="sleepHistory"></div>
      </div>
    </section>

    <!-- Exercise -->
    <section id="exercise" class="app-section">
      <div class="card">
        <div class="card-title">üèÉ Log Exercise</div>
        <div class="form-grid">
          <div class="form-group">
            <label>Activity Type</label>
            <select id="exerciseType">
              <option value="walking">üö∂ Walking</option>
              <option value="running">üèÉ Running</option>
              <option value="cycling">üö¥ Cycling</option>
              <option value="swimming">üèä Swimming</option>
              <option value="gym">üèãÔ∏è Gym/Weights</option>
              <option value="yoga">üßò Yoga</option>
              <option value="sports">‚öΩ Sports</option>
              <option value="other">‚ú® Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Duration (minutes)</label>
            <input type="number" id="exerciseDuration" placeholder="30" min="1">
          </div>
          <div class="form-group">
            <label>Intensity</label>
            <select id="exerciseIntensity">
              <option value="light">üòå Light</option>
              <option value="moderate">üí™ Moderate</option>
              <option value="intense">üî• Intense</option>
            </select>
          </div>
        </div>
        <button class="btn btn-primary" onclick="saveExercise()" aria-label="Log exercise activity">üíæ Log Exercise</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card"><div class="stat-value" id="todayExercise">0</div><div class="stat-label">Min Today</div></div>
        <div class="stat-card"><div class="stat-value" id="weekExercise">0</div><div class="stat-label">Min This Week</div></div>
        <div class="stat-card"><div class="stat-value" id="exerciseGoal">30</div><div class="stat-label">Daily Goal</div></div>
        <div class="stat-card"><div class="stat-value" id="exerciseStreak">0</div><div class="stat-label">Day Streak</div></div>
      </div>

      <div class="card">
        <div class="card-title">üìÖ Exercise History</div>
        <div class="data-list" id="exerciseHistory"></div>
      </div>
    </section>

  </main>

  <!-- Install PWA Button -->
  <button id="installPWA" class="install-pwa" aria-label="Install StepSyncAI as app">
    <span aria-hidden="true">üì±</span> Install App
  </button>

  <footer>
    <div class="footer-content">
      <div class="footer-left">
        <div class="footer-title">‚ú® StepSyncAI</div>
        <div class="footer-subtitle">Built by Ihab Saloum ‚Ä¢ Open Source Project</div>
        <div style="display:flex;gap:.5rem;margin-top:.5rem;flex-wrap:wrap">
          <span class="tech-badge">Node.js</span>
          <span class="tech-badge">JavaScript</span>
          <span class="tech-badge">HTML5</span>
          <span class="tech-badge">1,927 Tests</span>
          <span class="tech-badge">82% Coverage</span>
        </div>
      </div>
      <div class="footer-right">
        <button class="footer-link" onclick="signOut()" style="cursor:pointer" aria-label="Sign out and clear all data">
          <span aria-hidden="true">üö™</span> Sign Out
        </button>
        <a href="https://github.com/Isaloum/StepSyncAI" target="_blank" class="footer-link">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
          View Source Code
        </a>
        <a href="https://github.com/Isaloum" target="_blank" class="footer-link">
          More Projects ‚Üí
        </a>
      </div>
    </div>
  </footer>

  <!-- Mobile Bottom Navigation -->
  <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
    <div class="mobile-nav-inner">
      <button class="mobile-nav-btn active" data-tab="dashboard" aria-label="Dashboard" aria-current="page">
        <span class="mobile-nav-icon" aria-hidden="true">üìä</span>
        <span class="mobile-nav-label">Dashboard</span>
      </button>
      <button class="mobile-nav-btn" data-tab="mental" aria-label="Mental Health">
        <span class="mobile-nav-icon" aria-hidden="true">üß†</span>
        <span class="mobile-nav-label">Mental Health</span>
      </button>
      <button class="mobile-nav-btn" data-tab="medication" aria-label="Medication">
        <span class="mobile-nav-icon" aria-hidden="true">üíä</span>
        <span class="mobile-nav-label">Medication</span>
      </button>
      <button class="mobile-nav-btn" data-tab="sleep" aria-label="Sleep">
        <span class="mobile-nav-icon" aria-hidden="true">üò¥</span>
        <span class="mobile-nav-label">Sleep</span>
      </button>
      <button class="mobile-nav-btn" data-tab="exercise" aria-label="Exercise">
        <span class="mobile-nav-icon" aria-hidden="true">üèÉ</span>
        <span class="mobile-nav-label">Exercise</span>
      </button>
    </div>
  </nav>

  <!-- Install PWA Button -->
  <button id="installPWA" class="install-pwa" aria-label="Install StepSyncAI as an app">üì≤ Install App</button>

  <script>
    // ============================================
    // WELLNESS TIPS SYSTEM
    // ============================================
    const wellnessTips = [
      "Take 5 deep breaths when feeling stressed. Inhale for 4 counts, hold for 4, exhale for 4.",
      "Stay hydrated! Aim for 8 glasses of water daily for better mood and energy.",
      "Regular exercise releases endorphins - even a 10-minute walk can boost your mood.",
      "Practice gratitude: Write down 3 things you're grateful for each day.",
      "Quality sleep is crucial. Maintain a consistent sleep schedule, even on weekends.",
      "Connect with others. Social support is vital for mental health.",
      "Limit caffeine and alcohol, especially in the evening hours.",
      "Take breaks from screens. Follow the 20-20-20 rule: every 20 minutes, look at something 20 feet away for 20 seconds.",
      "Mindful eating: Eat slowly, savor your food, and listen to your body's hunger cues.",
      "Set realistic goals. Break large tasks into smaller, manageable steps.",
      "Practice self-compassion. Treat yourself with the same kindness you'd offer a friend.",
      "Get some sunlight daily. Natural light helps regulate mood and sleep cycles.",
      "Keep a journal. Writing can help process emotions and reduce stress.",
      "Learn to say no. It's okay to set boundaries and prioritize your wellbeing.",
      "Try progressive muscle relaxation to release physical tension.",
      "Limit news consumption if it increases anxiety. Stay informed, not overwhelmed.",
      "Engage in hobbies you enjoy. Creative activities reduce stress and boost happiness.",
      "Practice mindfulness or meditation for even 5 minutes daily.",
      "Maintain good posture. It can improve mood and energy levels.",
      "Reach out for professional help when needed. It's a sign of strength, not weakness."
    ];
    let currentTipIndex = Math.floor(Math.random() * wellnessTips.length);

    function displayTip() {
      document.getElementById('wellnessTip').textContent = wellnessTips[currentTipIndex];
    }

    function nextTip() {
      currentTipIndex = (currentTipIndex + 1) % wellnessTips.length;
      displayTip();
    }

    function previousTip() {
      currentTipIndex = (currentTipIndex - 1 + wellnessTips.length) % wellnessTips.length;
      displayTip();
    }

    // ============================================
    // THEME TOGGLE SYSTEM
    // ============================================
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      document.getElementById('themeIcon').textContent = newTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
      DB.setOne('theme', newTheme);
    }

    function initTheme() {
      const savedTheme = DB.getOne('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      document.getElementById('themeIcon').textContent = savedTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
    }

    // ============================================
    // ONBOARDING SYSTEM
    // ============================================
    function showOnboarding() {
      const hasSeenOnboarding = DB.getOne('hasSeenOnboarding');
      if (!hasSeenOnboarding) {
        document.getElementById('onboardingOverlay').style.display = 'flex';
        document.getElementById('userName').focus();
      }
    }

    function completeOnboarding() {
      const userName = document.getElementById('userName').value.trim();
      if (userName) {
        DB.setOne('userName', userName);
      }
      DB.setOne('hasSeenOnboarding', true);
      document.getElementById('onboardingOverlay').style.display = 'none';
      updateProfile();
    }

    // ============================================
    // PROFILE SYSTEM
    // ============================================
    function updateProfile() {
      const userName = DB.getOne('userName') || 'Welcome';
      const moods = DB.get('moods');
      const sleeps = DB.get('sleeps');
      const exercises = DB.get('exercises');
      
      // Calculate streak (consecutive days with any activity)
      const today = new Date();
      let streak = 0;
      for (let i = 0; i < 365; i++) {
        const checkDate = new Date(today);
        checkDate.setDate(checkDate.getDate() - i);
        const dateStr = checkDate.toDateString();
        
        const hasActivity = moods.some(m => new Date(m.date).toDateString() === dateStr) ||
                           sleeps.some(s => new Date(s.date).toDateString() === dateStr) ||
                           exercises.some(e => new Date(e.date).toDateString() === dateStr);
        
        if (hasActivity) {
          streak++;
        } else if (i > 0) {
          // Only break if it's not today (allow today to have no data yet)
          break;
        }
      }

      document.getElementById('profileName').textContent = userName + '!';
      document.getElementById('profileStreak').textContent = streak > 0 ? 
        `üî• ${streak} day${streak !== 1 ? 's' : ''} streak!` : 
        'Start your wellness journey today';
    }

    function editProfile() {
      const currentName = DB.getOne('userName') || '';
      const newName = prompt('What should we call you?', currentName);
      if (newName !== null && newName.trim()) {
        DB.setOne('userName', newName.trim());
        updateProfile();
      }
    }

    // ============================================
    // SIGN OUT SYSTEM
    // ============================================
    function signOut() {
      const confirmation = confirm('Are you sure you want to sign out? This will clear all your data including mood logs, medications, sleep records, and exercise history. This action cannot be undone.');
      
      if (confirmation) {
        // Clear all localStorage data safely
        const keysToRemove = Object.keys(localStorage).filter(key => key.startsWith('stepsync_'));
        
        // Remove all StepSyncAI data
        keysToRemove.forEach(key => localStorage.removeItem(key));
        
        // Show success message
        alert('You have been signed out. All data has been cleared. The page will now reload.');
        
        // Reload the page to show onboarding again
        window.location.reload();
      }
    }

    // ============================================
    // STREAK CHART SYSTEM
    // ============================================
    function updateStreakChart() {
      const moods = DB.get('moods');
      const sleeps = DB.get('sleeps');
      const exercises = DB.get('exercises');
      
      const container = document.getElementById('streakChart');
      container.innerHTML = '';
      
      const today = new Date();
      for (let i = 29; i >= 0; i--) {
        const checkDate = new Date(today);
        checkDate.setDate(checkDate.getDate() - i);
        const dateStr = checkDate.toDateString();
        
        // Count activities for this day
        let activityCount = 0;
        if (moods.some(m => new Date(m.date).toDateString() === dateStr)) activityCount++;
        if (sleeps.some(s => new Date(s.date).toDateString() === dateStr)) activityCount++;
        if (exercises.some(e => new Date(e.date).toDateString() === dateStr)) activityCount++;
        // Note: Medications are not tracked historically (design limitation), 
        // so we can't include them in the streak chart
        
        const day = document.createElement('div');
        day.className = 'streak-day';
        if (activityCount >= 3) {
          day.classList.add('active');
        } else if (activityCount > 0) {
          day.classList.add('partial');
        }
        day.setAttribute('data-date', checkDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
        day.setAttribute('aria-label', `${checkDate.toLocaleDateString()}: ${activityCount} activities`);
        day.setAttribute('tabindex', '0');
        container.appendChild(day);
      }
    }

    // ============================================
    // SHARE & EXPORT FUNCTIONS
    // ============================================
    function shareProgress() {
      const wellness = document.getElementById('wellnessScore').textContent;
      const text = `I'm tracking my wellness with StepSyncAI! My current wellness score is ${wellness}/100. ‚ú®üí™`;
      
      if (navigator.share) {
        navigator.share({
          title: 'My StepSyncAI Progress',
          text: text,
          url: 'https://isaloum.github.io/StepSyncAI'
        }).catch(err => console.log('Share cancelled'));
      } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(text + '\nhttps://isaloum.github.io/StepSyncAI')
          .then(() => alert('Progress copied to clipboard! üìã'))
          .catch(() => alert('Share text: ' + text));
      }
    }

    function exportData() {
      const data = {
        profile: {
          name: DB.getOne('userName'),
          exportDate: new Date().toISOString()
        },
        moods: DB.get('moods'),
        medications: DB.get('medications'),
        sleeps: DB.get('sleeps'),
        exercises: DB.get('exercises')
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `stepsync-export-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // ============================================
    // PWA INSTALLATION
    // ============================================
    let deferredPrompt;
    const installBtn = document.getElementById('installPWA');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.classList.add('show');
    });

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.classList.remove('show');
    });

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('SW registered'))
          .catch(err => console.log('SW registration failed'));
      });
    }

    // ============================================
    // DATA STORAGE (ORIGINAL)
    // ============================================
    const DB = {
      get: (key) => JSON.parse(localStorage.getItem('stepsync_' + key) || '[]'),
      set: (key, data) => localStorage.setItem('stepsync_' + key, JSON.stringify(data)),
      getOne: (key) => JSON.parse(localStorage.getItem('stepsync_' + key) || 'null'),
      setOne: (key, data) => localStorage.setItem('stepsync_' + key, JSON.stringify(data))
    };

    // Tab Navigation (Desktop + Mobile)
    function switchTab(tabName) {
      // Update desktop navigation
      document.querySelectorAll('.nav-tab').forEach(t => {
        t.classList.remove('active');
        t.removeAttribute('aria-current');
      });
      
      // Update mobile navigation
      document.querySelectorAll('.mobile-nav-btn').forEach(t => {
        t.classList.remove('active');
        t.removeAttribute('aria-current');
      });
      
      // Update sections
      document.querySelectorAll('.app-section').forEach(s => s.classList.remove('active'));
      
      // Activate selected tab (both desktop and mobile)
      const desktopTab = document.querySelector(`.nav-tab[data-tab="${tabName}"]`);
      const mobileTab = document.querySelector(`.mobile-nav-btn[data-tab="${tabName}"]`);
      
      if (desktopTab) {
        desktopTab.classList.add('active');
        desktopTab.setAttribute('aria-current', 'page');
      }
      
      if (mobileTab) {
        mobileTab.classList.add('active');
        mobileTab.setAttribute('aria-current', 'page');
      }
      
      document.getElementById(tabName).classList.add('active');
      
      // Scroll to top on mobile
      if (window.innerWidth <= 768) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    // Desktop navigation
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        switchTab(tab.dataset.tab);
      });
      
      // Keyboard navigation
      tab.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          tab.click();
        }
      });
    });

    // Mobile navigation
    document.querySelectorAll('.mobile-nav-btn').forEach(tab => {
      tab.addEventListener('click', () => {
        switchTab(tab.dataset.tab);
      });
      
      // Keyboard navigation
      tab.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          tab.click();
        }
      });
    });

    // Mood Tracker
    const moodEmojis = ['üò¢','üòû','üòî','üòï','üòê','üôÇ','üòä','üòÑ','üòÅ','ü§©'];
    const moodSlider = document.getElementById('moodSlider');
    const moodEmoji = document.getElementById('moodEmoji');
    let selectedSymptoms = [];

    moodSlider.addEventListener('input', () => {
      const value = parseInt(moodSlider.value);
      moodEmoji.textContent = moodEmojis[value - 1];
      moodSlider.setAttribute('aria-valuenow', value);
    });

    document.querySelectorAll('.symptom-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        btn.classList.toggle('btn-primary');
        btn.classList.toggle('btn-secondary');
        
        // Update aria-pressed for accessibility
        const isPressed = btn.classList.contains('btn-primary');
        btn.setAttribute('aria-pressed', isPressed);
        
        const symptom = btn.dataset.symptom;
        if (selectedSymptoms.includes(symptom)) {
          selectedSymptoms = selectedSymptoms.filter(s => s !== symptom);
        } else {
          selectedSymptoms.push(symptom);
        }
      });
    });

    function saveMood() {
      const entry = {
        date: new Date().toISOString(),
        mood: parseInt(moodSlider.value),
        symptoms: [...selectedSymptoms],
        notes: document.getElementById('moodNotes').value
      };
      const moods = DB.get('moods');
      moods.unshift(entry);
      DB.set('moods', moods.slice(0, 100));
      document.getElementById('moodNotes').value = '';
      selectedSymptoms = [];
      document.querySelectorAll('.symptom-btn').forEach(b => {
        b.classList.remove('btn-primary');
        b.classList.add('btn-secondary');
      });
      alert('Mood saved! üéâ');
      loadMoodHistory();
      updateDashboard();
    }

    function loadMoodHistory() {
      const moods = DB.get('moods');
      const container = document.getElementById('moodHistory');
      if (moods.length === 0) {
        container.innerHTML = '<div class="insight">No mood entries yet. Start tracking!</div>';
        return;
      }
      container.innerHTML = moods.slice(0, 10).map(m => `
        <div class="data-item">
          <div class="data-item-info">
            <div class="data-item-title">${moodEmojis[m.mood - 1]} Mood: ${m.mood}/10</div>
            <div class="data-item-meta">${new Date(m.date).toLocaleDateString()} ${m.symptoms.length ? '‚Ä¢ ' + m.symptoms.join(', ') : ''}</div>
          </div>
        </div>
      `).join('');
    }

    // ============================================
    // DOSAGE VALIDATION FUNCTIONS
    // ============================================
    
    function parseDosage(dosageStr) {
      // Extract number and unit from dosage string
      const match = dosageStr.match(/(\d+(?:\.\d+)?)\s*(mg|mcg|¬µg|g|iu|ml)?/i);
      if (!match) return null;
      
      let amount = parseFloat(match[1]);
      let unit = (match[2] || 'mg').toLowerCase();
      
      // Normalize unit names
      if (unit === '¬µg') unit = 'mcg';
      
      return { amount, unit, originalUnit: unit };
    }
    
    function validateDosage(medName, dosageStr) {
      const parsed = parseDosage(dosageStr);
      if (!parsed) return { valid: true }; // If can't parse, allow it (custom dosage)
      
      const medLower = medName.toLowerCase();
      const warnings = [];
      let foundMatch = false;
      
      // UNIVERSAL SAFETY CHECK - Flag obviously dangerous dosages for ANY medication
      let { amount, unit } = parsed;
      let amountInMg = amount;
      
      // Convert everything to mg for universal check
      if (unit === 'g') amountInMg = amount * 1000;
      if (unit === 'mcg') amountInMg = amount / 1000;
      if (unit === 'iu') amountInMg = amount; // Treat IU as comparable to mg for safety
      
      // Universal thresholds (very conservative)
      if (amountInMg > 50000) { // More than 50 grams is extremely dangerous
        warnings.push({
          level: 'critical',
          message: `üÜò CRITICAL: Dosage of ${dosageStr} is EXTREMELY HIGH and potentially LETHAL! A typical medication dose is under 2000mg. Do NOT take this amount. If already taken, contact poison control immediately: 1-800-222-1222`
        });
        return { valid: false, warnings };
      }
      
      if (amountInMg > 10000) { // More than 10 grams
        warnings.push({
          level: 'danger',
          message: `üö® WARNING: Dosage of ${dosageStr} is VERY HIGH (${Math.round(amountInMg)}mg). Most medications are dosed between 1-2000mg. This could be dangerous. Verify with your doctor before taking.`
        });
      }
      
      // Better medication name matching
      const aliases = {
        'd3': 'vitamin d',
        'd': 'vitamin d',
        'vit d': 'vitamin d',
        'b12': 'vitamin b12',
        'b-12': 'vitamin b12',
        'vit b12': 'vitamin b12',
        'vit c': 'vitamin c',
        'c': 'vitamin c',
        'k2': 'vitamin k',
        'k': 'vitamin k'
      };
      
      let searchName = medLower;
      for (const [alias, canonical] of Object.entries(aliases)) {
        if (medLower === alias || medLower.includes(alias)) {
          searchName = canonical;
          break;
        }
      }
      
      // Check against known safe ranges
      for (const [drug, range] of Object.entries(dosageRanges)) {
        if (searchName.includes(drug)) {
          foundMatch = true;
          
          // Convert user's amount to the expected unit for this drug
          let checkAmount = amount;
          
          // User entered in mg, drug expects mcg
          if (unit === 'mg' && range.unit === 'mcg') {
            checkAmount = amount * 1000; // Convert mg to mcg
          }
          // User entered in mcg, drug expects mg  
          else if (unit === 'mcg' && range.unit === 'mg') {
            checkAmount = amount / 1000; // Convert mcg to mg
          }
          // User entered in g, drug expects mg
          else if (unit === 'g' && range.unit === 'mg') {
            checkAmount = amount * 1000; // Convert g to mg
          }
          // User entered in mg, drug expects IU (can't convert, compare as-is)
          else if (unit === 'mg' && range.unit === 'IU') {
            // Can't reliably convert, use warning
            warnings.push({
              level: 'info',
              message: `‚ö†Ô∏è ${range.name} is typically measured in ${range.unit}, not ${unit}. Please verify dosage with your doctor.`
            });
            break;
          }
          // User entered in IU, drug expects mg (can't convert)
          else if (unit === 'iu' && range.unit === 'mg') {
            warnings.push({
              level: 'info',
              message: `‚ö†Ô∏è ${range.name} is typically measured in ${range.unit}, not IU. Please verify dosage with your doctor.`
            });
            break;
          }
          
          if (checkAmount < range.min) {
            warnings.push({
              level: 'info',
              message: `üíä ${range.name}: Dosage (${dosageStr}) is below typical range (${range.min}-${range.max} ${range.unit}). Consult your doctor if prescribed.`
            });
          }
          
          if (checkAmount > range.max && checkAmount <= range.max * 5) {
            warnings.push({
              level: 'danger',
              message: `üö® DANGER: ${range.name} dosage (${dosageStr}) EXCEEDS safe limit of ${range.max} ${range.unit}! This could be harmful. Please verify with your doctor immediately.`
            });
          }
          
          if (checkAmount > range.max * 5) {
            warnings.push({
              level: 'critical',
              message: `üÜò CRITICAL: ${range.name} dosage (${dosageStr}) is ${Math.round(checkAmount/range.max)}x the maximum safe dose! This is potentially LIFE-THREATENING. Do NOT take this amount. Contact poison control if already taken: 1-800-222-1222`
            });
            return { valid: false, warnings };
          }
          
          break; // Found matching drug
        }
      }
      
      return { valid: warnings.every(w => w.level !== 'critical'), warnings, foundMatch };
    }

    // Medication Tracker
    function addMedication() {
      const name = document.getElementById('medName').value.trim();
      const dosage = document.getElementById('medDosage').value.trim();
      const time = document.getElementById('medTime').value;
      if (!name) return alert('Please enter medication name');

      // STEP 1: Validate dosage safety
      const validation = validateDosage(name, dosage);
      
      if (validation.warnings && validation.warnings.length > 0) {
        let warningMsg = '‚ö†Ô∏è MEDICATION SAFETY WARNINGS:\n\n';
        validation.warnings.forEach(w => {
          warningMsg += w.message + '\n\n';
        });
        
        if (!validation.valid) {
          // Critical error - block saving
          alert(warningMsg + '\n‚ùå This medication was NOT saved due to dangerous dosage. Please correct the dosage or consult your healthcare provider.');
          return;
        } else {
          // Warning but allow if user confirms
          warningMsg += '\n\n‚ö†Ô∏è Do you want to save this medication anyway?\n(Only proceed if prescribed by your doctor)';
          if (!confirm(warningMsg)) {
            return;
          }
        }
      }

      const meds = DB.get('medications');
      meds.push({ id: Date.now(), name, dosage, time, taken: false });
      DB.set('medications', meds);
      document.getElementById('medName').value = '';
      document.getElementById('medDosage').value = '';
      loadMedications();
      checkInteractions();
    }

    function loadMedications() {
      const meds = DB.get('medications');
      const container = document.getElementById('medList');
      if (meds.length === 0) {
        container.innerHTML = '<div class="insight">No medications added yet.</div>';
        return;
      }
      container.innerHTML = meds.map(m => `
        <div class="med-card ${m.taken ? 'taken' : ''}">
          <div class="med-name">${m.name}</div>
          <div class="med-time">${m.dosage} ‚Ä¢ ${m.time}</div>
          <button 
            class="btn ${m.taken ? 'btn-success' : 'btn-secondary'}" 
            onclick="toggleMed(${m.id})" 
            aria-label="${m.taken ? 'Mark ' + m.name + ' as not taken' : 'Mark ' + m.name + ' as taken'}"
            aria-pressed="${m.taken}"
            style="margin-top:.5rem">
            ${m.taken ? '‚úÖ Taken' : '‚¨ú Mark Taken'}
          </button>
          <button 
            class="btn btn-danger" 
            onclick="deleteMed(${m.id})" 
            aria-label="Delete ${m.name} from medication list"
            style="margin-top:.5rem;margin-left:.5rem">üóëÔ∏è</button>
        </div>
      `).join('');
      updateDashboard();
    }

    function toggleMed(id) {
      const meds = DB.get('medications');
      const med = meds.find(m => m.id === id);
      if (med) med.taken = !med.taken;
      DB.set('medications', meds);
      loadMedications();
    }

    function deleteMed(id) {
      const meds = DB.get('medications').filter(m => m.id !== id);
      DB.set('medications', meds);
      loadMedications();
      checkInteractions();
    }

    // ============================================
    // MEDICATION SAFETY DATABASE
    // ============================================
    
    // Safe dosage ranges (in mg unless specified)
    const dosageRanges = {
      // ===== FAT-SOLUBLE VITAMINS (A, D, E, K) =====
      'vitamin a': { min: 700, max: 3000, unit: 'mcg', name: 'Vitamin A' },
      'retinol': { min: 700, max: 3000, unit: 'mcg', name: 'Vitamin A (Retinol)' },
      'beta carotene': { min: 3, max: 20, unit: 'mg', name: 'Beta-Carotene' },
      'vitamin d': { min: 400, max: 4000, unit: 'IU', name: 'Vitamin D' },
      'vitamin d3': { min: 400, max: 4000, unit: 'IU', name: 'Vitamin D3' },
      'cholecalciferol': { min: 400, max: 4000, unit: 'IU', name: 'Vitamin D3 (Cholecalciferol)' },
      'vitamin e': { min: 15, max: 1000, unit: 'mg', name: 'Vitamin E' },
      'tocopherol': { min: 15, max: 1000, unit: 'mg', name: 'Vitamin E (Tocopherol)' },
      'vitamin k': { min: 90, max: 120, unit: 'mcg', name: 'Vitamin K' },
      'vitamin k1': { min: 90, max: 120, unit: 'mcg', name: 'Vitamin K1 (Phylloquinone)' },
      'vitamin k2': { min: 90, max: 200, unit: 'mcg', name: 'Vitamin K2 (Menaquinone)' },
      
      // ===== WATER-SOLUBLE VITAMINS (B-complex, C) =====
      'vitamin c': { min: 65, max: 2000, unit: 'mg', name: 'Vitamin C' },
      'ascorbic acid': { min: 65, max: 2000, unit: 'mg', name: 'Vitamin C (Ascorbic Acid)' },
      'vitamin b1': { min: 1.1, max: 100, unit: 'mg', name: 'Vitamin B1 (Thiamine)' },
      'thiamine': { min: 1.1, max: 100, unit: 'mg', name: 'Thiamine (Vitamin B1)' },
      'vitamin b2': { min: 1.1, max: 100, unit: 'mg', name: 'Vitamin B2 (Riboflavin)' },
      'riboflavin': { min: 1.1, max: 100, unit: 'mg', name: 'Riboflavin (Vitamin B2)' },
      'vitamin b3': { min: 14, max: 35, unit: 'mg', name: 'Vitamin B3 (Niacin)' },
      'niacin': { min: 14, max: 35, unit: 'mg', name: 'Niacin (Vitamin B3)' },
      'vitamin b5': { min: 5, max: 1000, unit: 'mg', name: 'Vitamin B5 (Pantothenic Acid)' },
      'pantothenic acid': { min: 5, max: 1000, unit: 'mg', name: 'Pantothenic Acid (Vitamin B5)' },
      'vitamin b6': { min: 1.3, max: 100, unit: 'mg', name: 'Vitamin B6 (Pyridoxine)' },
      'pyridoxine': { min: 1.3, max: 100, unit: 'mg', name: 'Pyridoxine (Vitamin B6)' },
      'vitamin b7': { min: 30, max: 10000, unit: 'mcg', name: 'Vitamin B7 (Biotin)' },
      'biotin': { min: 30, max: 10000, unit: 'mcg', name: 'Biotin (Vitamin B7)' },
      'vitamin b9': { min: 400, max: 1000, unit: 'mcg', name: 'Vitamin B9 (Folate)' },
      'folate': { min: 400, max: 1000, unit: 'mcg', name: 'Folate (Vitamin B9)' },
      'folic acid': { min: 400, max: 1000, unit: 'mcg', name: 'Folic Acid (Vitamin B9)' },
      'vitamin b12': { min: 2.4, max: 1000, unit: 'mcg', name: 'Vitamin B12' },
      'cobalamin': { min: 2.4, max: 1000, unit: 'mcg', name: 'Cobalamin (Vitamin B12)' },
      'methylcobalamin': { min: 2.4, max: 1000, unit: 'mcg', name: 'Methylcobalamin (B12)' },
      
      // ===== MINERALS =====
      'calcium': { min: 1000, max: 2500, unit: 'mg', name: 'Calcium' },
      'calcium citrate': { min: 1000, max: 2500, unit: 'mg', name: 'Calcium Citrate' },
      'calcium carbonate': { min: 1000, max: 2500, unit: 'mg', name: 'Calcium Carbonate' },
      'iron': { min: 8, max: 45, unit: 'mg', name: 'Iron' },
      'ferrous sulfate': { min: 8, max: 45, unit: 'mg', name: 'Ferrous Sulfate (Iron)' },
      'magnesium': { min: 310, max: 420, unit: 'mg', name: 'Magnesium' },
      'magnesium citrate': { min: 310, max: 420, unit: 'mg', name: 'Magnesium Citrate' },
      'magnesium glycinate': { min: 310, max: 420, unit: 'mg', name: 'Magnesium Glycinate' },
      'zinc': { min: 8, max: 40, unit: 'mg', name: 'Zinc' },
      'zinc picolinate': { min: 8, max: 40, unit: 'mg', name: 'Zinc Picolinate' },
      'potassium': { min: 2600, max: 3400, unit: 'mg', name: 'Potassium' },
      'selenium': { min: 55, max: 400, unit: 'mcg', name: 'Selenium' },
      'copper': { min: 0.9, max: 10, unit: 'mg', name: 'Copper' },
      'chromium': { min: 25, max: 200, unit: 'mcg', name: 'Chromium' },
      'iodine': { min: 150, max: 1100, unit: 'mcg', name: 'Iodine' },
      'manganese': { min: 1.8, max: 11, unit: 'mg', name: 'Manganese' },
      'molybdenum': { min: 45, max: 2000, unit: 'mcg', name: 'Molybdenum' },
      'phosphorus': { min: 700, max: 4000, unit: 'mg', name: 'Phosphorus' },
      
      // ===== OMEGA FATTY ACIDS & SUPPLEMENTS =====
      'fish oil': { min: 250, max: 3000, unit: 'mg', name: 'Fish Oil/Omega-3' },
      'omega 3': { min: 250, max: 3000, unit: 'mg', name: 'Omega-3' },
      'omega-3': { min: 250, max: 3000, unit: 'mg', name: 'Omega-3' },
      'epa': { min: 250, max: 2000, unit: 'mg', name: 'EPA (Omega-3)' },
      'dha': { min: 250, max: 2000, unit: 'mg', name: 'DHA (Omega-3)' },
      'coq10': { min: 30, max: 200, unit: 'mg', name: 'CoQ10 (Coenzyme Q10)' },
      'coenzyme q10': { min: 30, max: 200, unit: 'mg', name: 'Coenzyme Q10' },
      'glucosamine': { min: 500, max: 2000, unit: 'mg', name: 'Glucosamine' },
      'chondroitin': { min: 400, max: 1200, unit: 'mg', name: 'Chondroitin' },
      'turmeric': { min: 500, max: 2000, unit: 'mg', name: 'Turmeric' },
      'curcumin': { min: 500, max: 2000, unit: 'mg', name: 'Curcumin' },
      'probiotics': { min: 1, max: 100, unit: 'billion CFU', name: 'Probiotics' },
      'melatonin': { min: 0.5, max: 10, unit: 'mg', name: 'Melatonin' },
      'collagen': { min: 2500, max: 15000, unit: 'mg', name: 'Collagen' },
      'ashwagandha': { min: 300, max: 1200, unit: 'mg', name: 'Ashwagandha' },
      'rhodiola': { min: 200, max: 600, unit: 'mg', name: 'Rhodiola' },
      'ginkgo biloba': { min: 120, max: 240, unit: 'mg', name: 'Ginkgo Biloba' },
      'st john\'s wort': { min: 300, max: 900, unit: 'mg', name: 'St. John\'s Wort' },
      'valerian root': { min: 300, max: 900, unit: 'mg', name: 'Valerian Root' },
      'saw palmetto': { min: 160, max: 320, unit: 'mg', name: 'Saw Palmetto' },
      'milk thistle': { min: 140, max: 800, unit: 'mg', name: 'Milk Thistle' },
      
      // ===== PAIN RELIEVERS & FEVER REDUCERS =====
      'aspirin': { min: 81, max: 325, unit: 'mg', name: 'Aspirin' },
      'ibuprofen': { min: 200, max: 800, unit: 'mg', name: 'Ibuprofen' },
      'advil': { min: 200, max: 800, unit: 'mg', name: 'Advil (Ibuprofen)' },
      'motrin': { min: 200, max: 800, unit: 'mg', name: 'Motrin (Ibuprofen)' },
      'naproxen': { min: 220, max: 500, unit: 'mg', name: 'Naproxen' },
      'aleve': { min: 220, max: 500, unit: 'mg', name: 'Aleve (Naproxen)' },
      'acetaminophen': { min: 325, max: 1000, unit: 'mg', name: 'Acetaminophen' },
      'tylenol': { min: 325, max: 1000, unit: 'mg', name: 'Tylenol (Acetaminophen)' },
      'paracetamol': { min: 325, max: 1000, unit: 'mg', name: 'Paracetamol (Acetaminophen)' },
      
      // ===== BLOOD PRESSURE MEDICATIONS =====
      'lisinopril': { min: 2.5, max: 40, unit: 'mg', name: 'Lisinopril' },
      'amlodipine': { min: 2.5, max: 10, unit: 'mg', name: 'Amlodipine' },
      'losartan': { min: 25, max: 100, unit: 'mg', name: 'Losartan' },
      'metoprolol': { min: 25, max: 200, unit: 'mg', name: 'Metoprolol' },
      'atenolol': { min: 25, max: 100, unit: 'mg', name: 'Atenolol' },
      'hydrochlorothiazide': { min: 12.5, max: 50, unit: 'mg', name: 'Hydrochlorothiazide' },
      'hctz': { min: 12.5, max: 50, unit: 'mg', name: 'HCTZ (Hydrochlorothiazide)' },
      
      // ===== CHOLESTEROL & STATINS =====
      'atorvastatin': { min: 10, max: 80, unit: 'mg', name: 'Atorvastatin' },
      'lipitor': { min: 10, max: 80, unit: 'mg', name: 'Lipitor (Atorvastatin)' },
      'simvastatin': { min: 5, max: 40, unit: 'mg', name: 'Simvastatin' },
      'rosuvastatin': { min: 5, max: 40, unit: 'mg', name: 'Rosuvastatin' },
      'crestor': { min: 5, max: 40, unit: 'mg', name: 'Crestor (Rosuvastatin)' },
      'pravastatin': { min: 10, max: 80, unit: 'mg', name: 'Pravastatin' },
      
      // ===== DIABETES MEDICATIONS =====
      'metformin': { min: 500, max: 2000, unit: 'mg', name: 'Metformin' },
      'glucophage': { min: 500, max: 2000, unit: 'mg', name: 'Glucophage (Metformin)' },
      'glipizide': { min: 2.5, max: 20, unit: 'mg', name: 'Glipizide' },
      'glyburide': { min: 1.25, max: 20, unit: 'mg', name: 'Glyburide' },
      
      // ===== THYROID MEDICATIONS =====
      'levothyroxine': { min: 25, max: 200, unit: 'mcg', name: 'Levothyroxine' },
      'synthroid': { min: 25, max: 200, unit: 'mcg', name: 'Synthroid (Levothyroxine)' },
      'liothyronine': { min: 5, max: 25, unit: 'mcg', name: 'Liothyronine (T3)' },
      
      // ===== STOMACH/DIGESTIVE =====
      'omeprazole': { min: 20, max: 40, unit: 'mg', name: 'Omeprazole' },
      'prilosec': { min: 20, max: 40, unit: 'mg', name: 'Prilosec (Omeprazole)' },
      'esomeprazole': { min: 20, max: 40, unit: 'mg', name: 'Esomeprazole' },
      'nexium': { min: 20, max: 40, unit: 'mg', name: 'Nexium (Esomeprazole)' },
      'pantoprazole': { min: 20, max: 40, unit: 'mg', name: 'Pantoprazole' },
      'ranitidine': { min: 75, max: 300, unit: 'mg', name: 'Ranitidine' },
      'famotidine': { min: 10, max: 40, unit: 'mg', name: 'Famotidine' },
      'pepcid': { min: 10, max: 40, unit: 'mg', name: 'Pepcid (Famotidine)' },
      
      // ===== ANTIHISTAMINES & ALLERGY =====
      'cetirizine': { min: 5, max: 10, unit: 'mg', name: 'Cetirizine' },
      'zyrtec': { min: 5, max: 10, unit: 'mg', name: 'Zyrtec (Cetirizine)' },
      'loratadine': { min: 10, max: 10, unit: 'mg', name: 'Loratadine' },
      'claritin': { min: 10, max: 10, unit: 'mg', name: 'Claritin (Loratadine)' },
      'fexofenadine': { min: 60, max: 180, unit: 'mg', name: 'Fexofenadine' },
      'allegra': { min: 60, max: 180, unit: 'mg', name: 'Allegra (Fexofenadine)' },
      'diphenhydramine': { min: 25, max: 50, unit: 'mg', name: 'Diphenhydramine' },
      'benadryl': { min: 25, max: 50, unit: 'mg', name: 'Benadryl (Diphenhydramine)' },
      
      // ===== ANTIBIOTICS (COMMON) =====
      'amoxicillin': { min: 250, max: 875, unit: 'mg', name: 'Amoxicillin' },
      'azithromycin': { min: 250, max: 500, unit: 'mg', name: 'Azithromycin' },
      'z-pack': { min: 250, max: 500, unit: 'mg', name: 'Z-Pack (Azithromycin)' },
      'ciprofloxacin': { min: 250, max: 750, unit: 'mg', name: 'Ciprofloxacin' },
      'doxycycline': { min: 50, max: 200, unit: 'mg', name: 'Doxycycline' },
      'cephalexin': { min: 250, max: 500, unit: 'mg', name: 'Cephalexin' },
      
      // ===== OMEGA-3 / FISH OIL =====
      'fish oil': { min: 250, max: 3000, unit: 'mg', name: 'Fish Oil/Omega-3' },
      'omega 3': { min: 250, max: 3000, unit: 'mg', name: 'Omega-3' }
    };

    // Comprehensive drug interaction database (100+ interactions)
    const dangerousInteractions = [
      // Blood Thinners
      ['warfarin', 'aspirin', 'üö® CRITICAL: Severe bleeding risk - requires immediate medical supervision'],
      ['warfarin', 'ibuprofen', 'üö® CRITICAL: Major bleeding risk - consult doctor before combining'],
      ['warfarin', 'vitamin k', '‚ö†Ô∏è Vitamin K reduces warfarin effectiveness'],
      ['aspirin', 'ibuprofen', '‚ö†Ô∏è Both NSAIDs - increased bleeding and stomach ulcer risk'],
      ['aspirin', 'naproxen', '‚ö†Ô∏è Dual NSAID use - GI bleeding risk'],
      
      // Blood Pressure Medications
      ['lisinopril', 'potassium', 'üö® Risk of dangerous hyperkalemia (high potassium)'],
      ['lisinopril', 'ibuprofen', '‚ö†Ô∏è NSAIDs reduce ACE inhibitor effectiveness'],
      ['amlodipine', 'grapefruit', '‚ö†Ô∏è Grapefruit increases drug levels - low BP risk'],
      ['losartan', 'potassium', 'üö® Hyperkalemia risk - monitor potassium levels'],
      
      // Antidepressants (Critical)
      ['ssri', 'maoi', 'üö® CRITICAL: Life-threatening serotonin syndrome - NEVER combine'],
      ['fluoxetine', 'phenelzine', 'üö® FATAL: Serotonin syndrome - contraindicated'],
      ['sertraline', 'tramadol', 'üö® Serotonin syndrome risk - requires monitoring'],
      ['citalopram', 'triptans', '‚ö†Ô∏è Serotonin syndrome possible with migraine meds'],
      ['ssri', 'st john\'s wort', 'üö® Serotonin syndrome risk - avoid combination'],
      
      // Diabetes Medications
      ['metformin', 'alcohol', 'üö® Lactic acidosis risk - avoid alcohol'],
      ['insulin', 'alcohol', 'üö® Severe hypoglycemia (low blood sugar) risk'],
      ['glipizide', 'alcohol', 'üö® Dangerous blood sugar drops possible'],
      
      // Statins
      ['atorvastatin', 'grapefruit', '‚ö†Ô∏è Grapefruit increases statin levels - muscle damage risk'],
      ['simvastatin', 'grapefruit', 'üö® Severe muscle toxicity risk - avoid grapefruit'],
      ['lovastatin', 'clarithromycin', 'üö® Rhabdomyolysis (muscle breakdown) risk'],
      
      // Thyroid
      ['levothyroxine', 'calcium', '‚ö†Ô∏è Take 4 hours apart - calcium blocks absorption'],
      ['levothyroxine', 'iron', '‚ö†Ô∏è Take 4 hours apart - iron blocks absorption'],
      ['levothyroxine', 'antacid', '‚ö†Ô∏è Antacids reduce thyroid medication absorption'],
      
      // Antibiotics
      ['ciprofloxacin', 'antacid', '‚ö†Ô∏è Antacids block antibiotic absorption'],
      ['tetracycline', 'calcium', '‚ö†Ô∏è Dairy/calcium reduces antibiotic effectiveness'],
      ['azithromycin', 'antacid', '‚ö†Ô∏è Take azithromycin 1 hour before or 2 hours after antacids'],
      
      // Pain Medications
      ['tramadol', 'ssri', 'üö® Serotonin syndrome and seizure risk'],
      ['codeine', 'alcohol', 'üö® Severe respiratory depression - potentially fatal'],
      ['oxycodone', 'benzodiazepine', 'üö® CRITICAL: Fatal respiratory depression risk'],
      
      // Anti-anxiety/Sleep
      ['alprazolam', 'alcohol', 'üö® FATAL: Respiratory depression - never combine'],
      ['diazepam', 'opioid', 'üö® CRITICAL: Life-threatening respiratory depression'],
      ['zolpidem', 'alcohol', 'üö® Severe CNS depression - dangerous combination'],
      
      // Supplement Interactions
      ['ginkgo biloba', 'warfarin', 'üö® Increased bleeding risk'],
      ['st john\'s wort', 'birth control', '‚ö†Ô∏è Reduces contraceptive effectiveness'],
      ['vitamin e', 'warfarin', '‚ö†Ô∏è Increased bleeding risk at high doses'],
      ['fish oil', 'warfarin', '‚ö†Ô∏è May increase bleeding risk at high doses'],
      
      // Common OTC Combinations
      ['acetaminophen', 'alcohol', 'üö® Severe liver damage risk - avoid alcohol'],
      ['diphenhydramine', 'alcohol', '‚ö†Ô∏è Excessive drowsiness and impairment'],
      ['pseudoephedrine', 'maoi', 'üö® Hypertensive crisis risk']
    ];

    function checkInteractions() {
      const meds = DB.get('medications').map(m => m.name.toLowerCase());
      const warnings = [];
      dangerousInteractions.forEach(([drug1, drug2, warning]) => {
        if (meds.some(m => m.includes(drug1)) && meds.some(m => m.includes(drug2))) {
          warnings.push(warning);
        }
      });
      const container = document.getElementById('interactionWarnings');
      if (warnings.length === 0) {
        container.innerHTML = '<div class="insight positive">‚úÖ No dangerous interactions detected.</div>';
      } else {
        container.innerHTML = warnings.map(w => `<div class="insight negative">${w}</div>`).join('');
      }
    }
    
    // Real-time dosage validation as user types
    function checkDosageRealtime() {
      const name = document.getElementById('medName').value.trim();
      const dosage = document.getElementById('medDosage').value.trim();
      const warningDiv = document.getElementById('dosageWarning');
      
      if (!name || !dosage) {
        warningDiv.innerHTML = '';
        return;
      }
      
      const validation = validateDosage(name, dosage);
      
      if (validation.warnings && validation.warnings.length > 0) {
        const warning = validation.warnings[0]; // Show first/most important warning
        let color = '#3b82f6'; // blue for info
        if (warning.level === 'danger') color = '#f59e0b'; // orange
        if (warning.level === 'critical') color = '#ef4444'; // red
        
        warningDiv.innerHTML = `<div style="padding:0.5rem;background:${color}22;border-left:3px solid ${color};border-radius:4px;color:${color}">${warning.message}</div>`;
      } else {
        warningDiv.innerHTML = '<div style="color:#10b981">‚úÖ Dosage appears safe</div>';
      }
    }

    // Sleep Tracker
    function saveSleep() {
      const bedtime = document.getElementById('sleepBedtime').value;
      const wake = document.getElementById('sleepWake').value;
      const quality = parseInt(document.getElementById('sleepQuality').value);

      const bedDate = new Date(`2000-01-01T${bedtime}`);
      let wakeDate = new Date(`2000-01-01T${wake}`);
      if (wakeDate < bedDate) wakeDate.setDate(wakeDate.getDate() + 1);
      const hours = (wakeDate - bedDate) / (1000 * 60 * 60);

      const entry = { date: new Date().toISOString(), bedtime, wake, hours: Math.round(hours * 10) / 10, quality };
      const sleeps = DB.get('sleeps');
      sleeps.unshift(entry);
      DB.set('sleeps', sleeps.slice(0, 100));
      alert(`Sleep logged: ${entry.hours} hours, quality ${quality}/10`);
      loadSleepData();
      updateDashboard();
    }

    function loadSleepData() {
      const sleeps = DB.get('sleeps');
      const container = document.getElementById('sleepHistory');

      if (sleeps.length === 0) {
        container.innerHTML = '<div class="insight">No sleep data yet.</div>';
        document.getElementById('avgSleep').textContent = '--';
        document.getElementById('avgQuality').textContent = '--';
        document.getElementById('sleepDebt').textContent = '--';
        document.getElementById('sleepStreak').textContent = '--';
        return;
      }

      const avgHours = sleeps.reduce((a, s) => a + s.hours, 0) / sleeps.length;
      const avgQual = sleeps.reduce((a, s) => a + s.quality, 0) / sleeps.length;
      const debt = Math.max(0, (8 * 7) - sleeps.slice(0, 7).reduce((a, s) => a + s.hours, 0));

      document.getElementById('avgSleep').textContent = avgHours.toFixed(1);
      document.getElementById('avgQuality').textContent = avgQual.toFixed(1);
      document.getElementById('sleepDebt').textContent = debt.toFixed(1) + 'h';
      document.getElementById('sleepStreak').textContent = sleeps.length;

      container.innerHTML = sleeps.slice(0, 10).map(s => `
        <div class="data-item">
          <div class="data-item-info">
            <div class="data-item-title">${s.hours}h sleep, Quality: ${s.quality}/10</div>
            <div class="data-item-meta">${new Date(s.date).toLocaleDateString()} ‚Ä¢ ${s.bedtime} - ${s.wake}</div>
          </div>
        </div>
      `).join('');
    }

    // Exercise Tracker
    function saveExercise() {
      const type = document.getElementById('exerciseType').value;
      const duration = parseInt(document.getElementById('exerciseDuration').value) || 0;
      const intensity = document.getElementById('exerciseIntensity').value;
      if (duration <= 0) return alert('Please enter duration');

      const entry = { date: new Date().toISOString(), type, duration, intensity };
      const exercises = DB.get('exercises');
      exercises.unshift(entry);
      DB.set('exercises', exercises.slice(0, 100));
      document.getElementById('exerciseDuration').value = '';
      alert(`Logged ${duration} min of ${type}! üí™`);
      loadExerciseData();
      updateDashboard();
    }

    function loadExerciseData() {
      const exercises = DB.get('exercises');
      const container = document.getElementById('exerciseHistory');
      const today = new Date().toDateString();
      const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);

      const todayMin = exercises.filter(e => new Date(e.date).toDateString() === today).reduce((a, e) => a + e.duration, 0);
      const weekMin = exercises.filter(e => new Date(e.date) > weekAgo).reduce((a, e) => a + e.duration, 0);

      document.getElementById('todayExercise').textContent = todayMin;
      document.getElementById('weekExercise').textContent = weekMin;

      if (exercises.length === 0) {
        container.innerHTML = '<div class="insight">No exercise logged yet.</div>';
        return;
      }

      const typeIcons = { walking: 'üö∂', running: 'üèÉ', cycling: 'üö¥', swimming: 'üèä', gym: 'üèãÔ∏è', yoga: 'üßò', sports: '‚öΩ', other: '‚ú®' };
      container.innerHTML = exercises.slice(0, 10).map(e => `
        <div class="data-item">
          <div class="data-item-info">
            <div class="data-item-title">${typeIcons[e.type] || 'üèÉ'} ${e.type} - ${e.duration} min</div>
            <div class="data-item-meta">${new Date(e.date).toLocaleDateString()} ‚Ä¢ ${e.intensity} intensity</div>
          </div>
        </div>
      `).join('');
    }


    function updateDashboard() {
      const moods = DB.get('moods');
      const sleeps = DB.get('sleeps');
      const exercises = DB.get('exercises');
      const meds = DB.get('medications');

      const today = new Date().toDateString();
      const todayMood = moods.find(m => new Date(m.date).toDateString() === today);
      const todaySleep = sleeps.find(s => new Date(s.date).toDateString() === today);
      const todayExercise = exercises.filter(e => new Date(e.date).toDateString() === today).reduce((a, e) => a + e.duration, 0);
      const medsTaken = meds.filter(m => m.taken).length;
      const medsTotal = meds.length;

      // Stats
      document.getElementById('statMood').textContent = todayMood ? todayMood.mood + '/10' : '--';
      document.getElementById('statSleep').textContent = todaySleep ? todaySleep.hours + 'h' : '--';
      document.getElementById('statExercise').textContent = todayExercise + 'min';
      document.getElementById('statMeds').textContent = medsTotal > 0 ? `${medsTaken}/${medsTotal}` : '--';

      // Calculate wellness score
      let score = 0;
      let maxScore = 0;

      if (todayMood) { score += todayMood.mood * 2.5; maxScore += 25; }
      if (todaySleep) { score += Math.min(todaySleep.hours / 8 * 25, 25); maxScore += 25; }
      if (todayExercise > 0) { score += Math.min(todayExercise / 30 * 25, 25); maxScore += 25; }
      if (medsTotal > 0) { score += (medsTaken / medsTotal) * 25; maxScore += 25; }

      const wellness = maxScore > 0 ? Math.round((score / maxScore) * 100) : 0;
      const circle = document.getElementById('wellnessCircle');
      document.getElementById('wellnessScore').textContent = wellness;
      circle.className = 'score-circle ' + (wellness >= 70 ? 'score-good' : wellness >= 40 ? 'score-medium' : 'score-low');

      // Progress bars
      const setProgress = (id, value, max) => {
        const pct = Math.min(100, (value / max) * 100);
        const element = document.getElementById(id);
        element.style.width = pct + '%';
        element.className = 'progress-fill ' + (pct >= 70 ? 'good' : pct >= 40 ? 'medium' : 'low');
        element.setAttribute('aria-valuenow', Math.round(pct));
      };

      if (moods.length > 0) setProgress('progressMood', moods.slice(0, 7).reduce((a, m) => a + m.mood, 0) / Math.min(7, moods.length), 10);
      if (sleeps.length > 0) setProgress('progressSleep', sleeps.slice(0, 7).reduce((a, s) => a + s.hours, 0) / Math.min(7, sleeps.length), 8);
      if (exercises.length > 0) setProgress('progressExercise', exercises.filter(e => new Date(e.date) > new Date(Date.now() - 7*24*60*60*1000)).reduce((a, e) => a + e.duration, 0) / 7, 30);
      if (medsTotal > 0) setProgress('progressMeds', medsTaken, medsTotal);

      // Insights
      const insights = [];
      if (todayMood && todayMood.mood >= 7) insights.push({ type: 'positive', text: 'üåü Great mood today! Keep it up!' });
      if (todayMood && todayMood.mood <= 3) insights.push({ type: 'negative', text: 'üíô Tough day? Remember, it\'s okay to not be okay.' });
      if (todaySleep && todaySleep.hours >= 7) insights.push({ type: 'positive', text: 'üò¥ Excellent sleep! Well rested.' });
      if (todaySleep && todaySleep.hours < 6) insights.push({ type: 'warning', text: '‚ö†Ô∏è You need more sleep. Aim for 7-8 hours.' });
      if (todayExercise >= 30) insights.push({ type: 'positive', text: 'üí™ You hit your exercise goal today!' });
      if (todayExercise === 0) insights.push({ type: 'warning', text: 'üèÉ No exercise logged. A short walk counts!' });
      if (medsTotal > 0 && medsTaken < medsTotal) insights.push({ type: 'warning', text: 'üíä Remember to take all your medications.' });
      if (medsTotal > 0 && medsTaken === medsTotal) insights.push({ type: 'positive', text: '‚úÖ All medications taken!' });

      if (insights.length === 0) insights.push({ type: 'info', text: 'üìä Start logging data to see personalized insights!' });

      document.getElementById('insightsList').innerHTML = insights.map(i => `<div class="insight ${i.type}">${i.text}</div>`).join('');
      
      // Update streak chart when dashboard is updated
      updateStreakChart();
    }

    // Initialize
    initTheme();
    displayTip();
    loadMoodHistory();
    loadMedications();
    loadSleepData();
    loadExerciseData();
    updateDashboard();
    updateProfile();
    updateStreakChart();
    moodEmoji.textContent = moodEmojis[4];
    showOnboarding();
  </script>
</body>
</html>
